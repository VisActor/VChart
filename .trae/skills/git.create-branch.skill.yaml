id: git.create-branch
version: v1
description: 从基础分支创建开发分支并返回分支名
domain: git
runner: orchestrator
dependencies:
  - git-cli
env: {}
parameters:
  - name: baseBranch
    type: string
    default: develop
    required: false
  - name: branchPrefix
    type: string
    default: chore/trae
    required: false
  - name: topic
    type: string
    required: true
  - name: useDateSuffix
    type: boolean
    default: true
    required: false
outputs:
  - name: branch_name
success_criteria:
  - branch_created
  - clean_working_tree
steps:
  - name: sync-base
    type: command
    uses: git-cli
    with:
      command: "git fetch --all --prune && git checkout ${parameters.baseBranch} && git pull origin ${parameters.baseBranch}"
  - name: gen-name
    type: composite
    with:
      rule: "${parameters.branchPrefix}-${parameters.topic}-${parameters.useDateSuffix ? '${YYYYMMDD-HHMM}' : ''}"
    save_as: branch_name
  - name: create
    type: command
    uses: git-cli
    with:
      command: "git checkout -b ${branch_name}"
  - name: verify
    type: command
    uses: git-cli
    with:
      command: "git status --porcelain"
    save_as: workingTree

