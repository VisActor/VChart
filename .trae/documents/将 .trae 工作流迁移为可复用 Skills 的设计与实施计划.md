## 背景与现状
- 当前仓库在 .trae 目录下以“Job + Solo 文档”的方式描述自动化任务流，包括单测自动生成、智能提交与推送、PR 创建、分支管理、Changelog 等。
- 典型 Job 文件包含清晰的元数据与参数约束，结构化步骤与成功标准，示例：
  - 作业总览与用法：[README.md](file:///Users/bytedance/Documents/GitHub/VChart/.trae/jobs/README.md)
  - 自动化单测生成：[auto-test.md](file:///Users/bytedance/Documents/GitHub/VChart/.trae/jobs/auto-test.md) 与说明文档：[auto-test.solo.md](file:///Users/bytedance/Documents/GitHub/VChart/.trae/documents/auto-test.solo.md)
  - 智能提交推送：[commit-smart.md](file:///Users/bytedance/Documents/GitHub/VChart/.trae/jobs/commit-smart.md)
  - 本地正文创建 PR：[pr-create-from-body.md](file:///Users/bytedance/Documents/GitHub/VChart/.trae/jobs/pr-create-from-body.md)

## 适配性评估（是否适合迁移为 Skills）
- 结构化良好：现有 Job 已具备“名称/意图/参数/输入输出/成功标准/步骤”的技能化必要元素，迁移成本低。
- 可移植性可控：多数步骤依赖标准 CLI（git、gh、rush、jest），通过工具抽象与参数化可跨 IDE 复用。
- 领域清晰：任务聚焦“测试/Git/GitHub”，适合拆分为多个职责单一的技能单元，便于组合编排。
- 风险与边界：
  - 环境依赖（rush、ts-jest、gh CLI）需在技能层声明“前置条件 + 兜底模式（REST/跳过）”。
  - 写文件与运行测试属“有副作用”，Skills 需提供 dry-run/preview/stopOnError 等保护与可观测性。
- 结论：适合迁移。推荐“分层拆分 + 通用工具适配 + 渐进迁移”，先迁 Git/PR 类，随后迁 Autotest 编排与子技能。

## 迁移目标与原则
- 目标：将 .trae/jobs 中的任务流标准化为跨 IDE 可复用的 Skills（带清晰的输入/输出/依赖/步骤），保留 Solo 可运行性，同时增设通用工具适配（兼容 gh/REST、CLI/协议）。
- 原则：
  - 单一职责、可组合：一个技能只解决一个明确问题；复杂流程由编排技能调用多个子技能。
  - 明确契约：参数类型/默认值/必填项、输出物路径与结构需固定、错误与成功标准一致可测。
  - 安全与幂等：dry-run 默认开启于危险操作；文件写入有覆盖策略；外部 API 使用令牌与最小权限。

## 技能清单与映射
- github.create-pr-from-file（来源：pr-create-from-body）
  - 输入：base、head、title（必填）、labels、draft、mode（auto|gh|rest）、bodyFile/localBodyFile、commitBeforeCreate 等
  - 工具适配：优先 gh CLI，其次 GitHub REST（GITHUB_TOKEN），失败时明确报错与指引
  - 输出：pr_url；成功标准：pr_created
- git.commit-push-smart（来源：commit-smart）
  - 输入：head、commitAllowEmpty、pushAfterCommit、commitMessageStrategy、message
  - 步骤：检测工作树 → 生成信息（路径/changes 类型推断）→ commit → push（可选）
  - 输出：commit_message、pushed_branch；成功标准：commit_created_or_skipped
- vcs.diff-collect（Autotest 子技能）
  - 输入：sinceBranch、includeWorkingTree
  - 输出：变更文件与行级差异结构体（JSON）
- test.autogen-from-diff（来源：auto-test）
  - 输入：project、mode、noSnapshot、onlyNew、applyManualOverrides、replaceAutogen 等
  - 步骤：分析导出符号 → 生成/增量更新 __tests__/*.test.ts（含函数级 JSDoc 注释）→ 运行覆盖率 → 写临时报告
  - 输出：test_files、snapshots、coverage_report、manual_nodes、temp_markdown_report；成功标准同原 Job
- github.pr-body-generate（来源：pr-body-generate）与 changelog.rush-smart、branch.create 等（按现有 Job 逐项映射）

## 技能规范（建议的 Skill Manifest）
- 顶层字段：id、version、description、domain、tags、runner（solo|orchestrator|mcp）、dependencies（cli/tools）、env（必需变量）。
- parameters：name、type（string|boolean|enum|file）、default、required、validate、visibility（advanced）。
- inputs/outputs：路径与结构约定（例如输出报告默认至 .trae/output/**，可覆盖）。
- success_criteria：机器可判定的条件列表；errors：常见失败及建议。
- steps：
  - type: command|tool|script|composite
  - uses: git/gh/github-rest/rush/jest 等适配器
  - with: 具体参数映射；guards：前置检查与兜底策略；dryRun: true/false；continueOnError: bool；
- 观测性：每步产生日志事件与可视化摘要，临时报告路径可配置。

## 通用工具抽象与 MCP 适配
- GitHub：抽象两种实现
  - gh CLI：gh pr create ...
  - REST：POST /repos/{owner}/{repo}/pulls（从环境读取 GITHUB_TOKEN）
- Git：抽象常用命令（rev-parse、status、add/commit/push、diff），允许替换成 IDE 的 Shell 执行器。
- 测试与覆盖率：抽象 rush/jest 执行器，支持 project 定位与并行；无 rush 环境时回退至 npm/yarn。
- 报告：统一写入（md|json），在不同 IDE 通过文件系统可见。

## 迁移步骤（渐进式）
1. 定义 Skill 模板与约束
  - 提炼通用 manifest 与步骤 DSL；建立“工具适配”层（gh/rest、git/shell、rush/jest）。
2. 先迁 Git/PR 类（低风险）
  - 将 commit-smart 与 pr-create-from-body 转为 skills；实现 gh/rest 双路；发布 dry-run 默认开。
3. 引入编排技能
  - 将 auto-test 拆为 orchestrator + 子技能（diff-collect、analysis、generate-tests、run-coverage、report）。
4. 标准化输出物与路径
  - 报告/快照/测试文件命名与路径统一；保留 .trae/output，允许通过参数覆盖。
5. 加入校验与回退
  - 环境检查（CLI、令牌、rush）；无法满足时按策略回退或提示。
6. 文档与示例
  - 为每个技能提供独立 README 与示例调用；保留原 .trae/documents 作为技能说明。
7. 验证与兼容发布
  - 在 Trae 中以 Solo 运行验证；在其他 IDE 通过“工具适配器 + 文件 IO”验证；发布 v1。

## 验证与发布策略
- 单元验证：每个技能提供“模拟输入 → 期望输出”的用例；dry-run 模式检查日志与报告。
- 集成验证：在真实仓库上跑全流程（先 Git/PR，再 Autotest）。
- 版本与回滚：语义化版本；变更日志；失败可回滚到 Job 运行方式。

## 风险与注意事项
- 环境差异：Windows/Mac/Linux 下命令差异与路径分隔符；rush/jest 可用性。
- 令牌与安全：不在仓库写入任何密钥；按环境变量读取；失败明确提示。
- 幂等与覆盖：replaceAutogen 参数遵循默认“增量插入，不覆盖人工块”。

## 里程碑与交付
- M1：完成 Skill 模板与工具适配层；迁移 commit-smart、pr-create-from-body。
- M2：完成 Autotest 子技能与编排；发布一致性报告格式；形成复用规范。
- M3：补齐 changelog、branch、pr-body-generate 等技能；完善文档与示例。