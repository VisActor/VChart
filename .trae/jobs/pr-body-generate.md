---
job: pr-body-generate
intent: github-pr-body
version: v1
domain: github
runner: trae-solo
parameters:
  lang: zh
  title: ''
  head: ''
  labels: []
  rushChangesDir: common/changes
  localBodyFile: true
  openEditor: false
required_parameters: []
inputs:
  autotestReport: .trae/output/autotest.report.local.md
outputs:
  - generated_title
  - generated_body_preview
  - generated_body_file
success_criteria:
  - body_generated
---

# 生成 PR 正文（支持人工修订）

## 参数检查

- 可选参数：`title`、`head`、`labels`
- 模板语言：`lang`（`zh|en`，默认 `zh`）
- 输出文件：当 `localBodyFile == true`，写入 `./.trae/output/pr.body.local.md`

## 步骤

1. 解析上下文与选择模板

- 推导 `head`：`git rev-parse --abbrev-ref HEAD`
- 模板选择：`lang == zh` → `.github/PULL_REQUEST_TEMPLATE/pr_cn.md`；否则 → `.github/PULL_REQUEST_TEMPLATE.md`

2. 自动填充内容

- 勾选项：`branchTypeChecks`（未提供则生成默认占位，如“新功能”、“Workflow”）
- 关联：`issue_links`、`related_pr_links`、`bugserver_ids`（未提供保留占位）
- 背景与方案：基于 `message` 首行摘要与变更上下文生成
- Changelog：解析 `rushChangesDir`（默认 `common/changes`），填充 `changelog_en` 与 `changelog_zh`
- 自测项：生成默认勾选列表；若存在 `autotestReport`，合并摘要至 Walkthrough
- Summary 与 Walkthrough：包含分支、模板来源、测试摘要与生成信息

3. 输出与保存

- 生成标题建议：`generated_title = [Auto] {{title || (topic || head)}}`
- 输出完整 `generated_body_preview`（Markdown 代码块，便于复制）
- 当 `localBodyFile == true`：写入 `./.trae/output/pr.body.local.md`（纯 Markdown，无外层三引号）并输出 `generated_body_file`
- 不在文件中追加任何生成标记或提示文本（如“Generated by ...”）；写入内容即为 PR body 原文
- 当 `openEditor == true`：在编辑器中打开正文文件以便人工修订

4. 人工检查点

- 请人工审阅并完善 `pr.body`，然后执行“创建 PR” Job（`pr-create-from-body`）
